# Dashboards y M√©tricas - Heal Platform

## 1. Dashboard Administrativo

### 1.1 Vista General

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         DASHBOARD ADMINISTRATIVO                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                                  ‚îÇ
‚îÇ  [Filtros: Fecha Desde ___ | Fecha Hasta ___ | Profesional ___ | Aplicar]      ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Ventas Mes      ‚îÇ ‚îÇ Cobranzas       ‚îÇ ‚îÇ Deuda Pendiente ‚îÇ ‚îÇ Saldos a Favor  ‚îÇ‚îÇ
‚îÇ  ‚îÇ $4.500.000      ‚îÇ ‚îÇ $4.200.000      ‚îÇ ‚îÇ $850.000        ‚îÇ ‚îÇ $120.000        ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚Üë 7.14%         ‚îÇ ‚îÇ 93.3% del total ‚îÇ ‚îÇ 12 pacientes    ‚îÇ ‚îÇ 5 pacientes     ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Sesiones Mes    ‚îÇ ‚îÇ Pacientes       ‚îÇ ‚îÇ Tasa Adherencia ‚îÇ ‚îÇ Tasa No-Show    ‚îÇ‚îÇ
‚îÇ  ‚îÇ 150 realizadas  ‚îÇ ‚îÇ 75 activos      ‚îÇ ‚îÇ 92.5%           ‚îÇ ‚îÇ 3.2%            ‚îÇ‚îÇ
‚îÇ  ‚îÇ 45 agendadas    ‚îÇ ‚îÇ 12 nuevos       ‚îÇ ‚îÇ ‚Üë 2.1%          ‚îÇ ‚îÇ ‚Üì 0.8%          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ     INGRESOS VS COBRANZAS          ‚îÇ ‚îÇ      SESIONES POR ESTADO           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                    ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  $5M ‚î§                             ‚îÇ ‚îÇ    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà Realizadas: 150 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      ‚îÇ    ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ                   ‚îÇ ‚îÇ    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà Pagadas: 140    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  $4M ‚î§   ‚ï±      ‚ï≤  ‚ï≠‚îÄ‚îÄ             ‚îÇ ‚îÇ    ‚ñà‚ñà‚ñà‚ñà‚ñà Pend. Pago: 10           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      ‚îÇ  ‚ï±        ‚ï≤‚ï±                ‚îÇ ‚îÇ    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà Con Boleta: 135 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  $3M ‚î§‚ï±                            ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ           ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ       Ene Feb Mar Abr May          ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ       ‚îÄ‚îÄ Ingresos  -- Cobrado      ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   DISTRIBUCI√ìN M√âTODO DE PAGO      ‚îÇ ‚îÇ      TOP PACIENTES CON DEUDA       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                    ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ                ‚îÇ ‚îÇ  1. Juan P√©rez      $120.000       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ        ‚ï± Transfer ‚ï≤                ‚îÇ ‚îÇ  2. Ana L√≥pez       $90.000        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ       ‚îÇ   55.6%    ‚îÇ               ‚îÇ ‚îÇ  3. Pedro Soto      $75.000        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ        ‚ï≤  D√©bito  ‚ï±                ‚îÇ ‚îÇ  4. Mar√≠a D√≠az      $60.000        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ         ‚ï≤ 26.7%  ‚ï±                 ‚îÇ ‚îÇ  5. Carlos Mu√±oz    $45.000        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ          ‚ï≤_____‚ï±                   ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ       Efectivo 11% | Cr√©dito 7%   ‚îÇ ‚îÇ  [Ver todos ‚Üí]                     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                              ALERTAS                                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚ö†Ô∏è 5 pacientes con deuda mayor a $100.000                                  ‚îÇ‚îÇ
‚îÇ  ‚îÇ  üî¥ 3 sesiones realizadas hace +5 d√≠as sin boleta                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚ÑπÔ∏è √öltima sincronizaci√≥n con Medilink: hace 5 minutos                      ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1.2 KPIs Administrativos

| KPI | Descripci√≥n | F√≥rmula | Target |
|-----|-------------|---------|--------|
| **Ventas Totales** | Valor de sesiones realizadas en el per√≠odo | SUM(sesiones.precioFinal) WHERE estadoAtencion = 'REALIZADA' | - |
| **Cobranzas** | Total efectivamente cobrado | SUM(pagos.monto) WHERE estado = 'CONFIRMADO' | 95% ventas |
| **Tasa de Cobranza** | % de ventas cobradas | Cobranzas / Ventas √ó 100 | > 90% |
| **Deuda Pendiente** | Monto por cobrar | SUM(sesiones.precioFinal - montoPagado) WHERE estadoPago != 'PAGADA' | < 10% ventas |
| **Saldos a Favor** | Pagos anticipados no utilizados | SUM(pagos.saldoDisponible) | - |
| **Sesiones Realizadas** | Sesiones completadas | COUNT(sesiones) WHERE estadoAtencion = 'REALIZADA' | - |
| **Pacientes Activos** | Pacientes con sesiones en el per√≠odo | COUNT(DISTINCT pacientes) con sesiones en per√≠odo | - |
| **Pacientes Nuevos** | Primeras atenciones | COUNT(pacientes) con primera sesi√≥n en per√≠odo | - |
| **Tasa de Adherencia** | Asistencia a citas agendadas | Sesiones realizadas / (Realizadas + No-show) √ó 100 | > 90% |
| **Tasa No-Show** | Pacientes que no llegan | Sesiones no-show / Total agendadas √ó 100 | < 5% |
| **Ticket Promedio** | Valor promedio por sesi√≥n | AVG(sesiones.precioFinal) | - |
| **LTV Paciente** | Valor de vida del paciente | AVG(total pagado por paciente) | - |

### 1.3 Gr√°ficos Administrativos

#### Ingresos por Per√≠odo
```typescript
// Query para ingresos mensuales
const ingresosPorMes = await prisma.sesion.groupBy({
  by: ['fechaHora'],
  where: {
    tenantId,
    estadoAtencion: 'REALIZADA',
    fechaHora: { gte: fechaDesde, lte: fechaHasta }
  },
  _sum: { precioFinal: true, montoPagado: true }
});
```

#### Distribuci√≥n por M√©todo de Pago
```typescript
const distribucionMetodoPago = await prisma.pago.groupBy({
  by: ['metodoPago'],
  where: {
    tenantId,
    estado: 'CONFIRMADO',
    fechaPago: { gte: fechaDesde, lte: fechaHasta }
  },
  _sum: { monto: true },
  _count: true
});
```

#### Sesiones por Estado
```typescript
const sesionesPorEstado = await prisma.sesion.groupBy({
  by: ['estadoPago', 'estadoBoleta'],
  where: {
    tenantId,
    estadoAtencion: 'REALIZADA',
    fechaHora: { gte: fechaDesde, lte: fechaHasta }
  },
  _count: true
});
```

---

## 2. Dashboard Profesional

### 2.1 Vista General

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         DASHBOARD PROFESIONAL                                    ‚îÇ
‚îÇ                         Dr. Carlos Mu√±oz - Kinesi√≥logo                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Pacientes       ‚îÇ ‚îÇ Sesiones Hoy    ‚îÇ ‚îÇ Sesiones Mes    ‚îÇ ‚îÇ Planes Activos  ‚îÇ‚îÇ
‚îÇ  ‚îÇ Activos: 25     ‚îÇ ‚îÇ 6 agendadas     ‚îÇ ‚îÇ 95 realizadas   ‚îÇ ‚îÇ 18 en curso     ‚îÇ‚îÇ
‚îÇ  ‚îÇ Total: 45       ‚îÇ ‚îÇ 4 completadas   ‚îÇ ‚îÇ 28 esta semana  ‚îÇ ‚îÇ 5 completados   ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                           AGENDA DE HOY                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ  09:00  ‚úÖ Mar√≠a Gonz√°lez   | Kinesiolog√≠a Traumat. | PAGADA     [Ver]      ‚îÇ‚îÇ
‚îÇ  ‚îÇ  09:30  ‚úÖ Pedro Soto       | Kinesiolog√≠a Deportiva| PAGADA     [Ver]      ‚îÇ‚îÇ
‚îÇ  ‚îÇ  10:00  ‚úÖ Ana L√≥pez        | Rehabilitaci√≥n        | PENDIENTE  [Ver]      ‚îÇ‚îÇ
‚îÇ  ‚îÇ  10:30  ‚úÖ Juan P√©rez       | Kinesiolog√≠a Traumat. | PAGADA     [Ver]      ‚îÇ‚îÇ
‚îÇ  ‚îÇ  11:00  ‚è≥ Carlos D√≠az      | Kinesiolog√≠a Deportiva| PAGADA     [Ver]      ‚îÇ‚îÇ
‚îÇ  ‚îÇ  11:30  ‚óã  Laura Mu√±oz      | Rehabilitaci√≥n        | PENDIENTE  [Ver]      ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ  ‚úÖ Completada  ‚è≥ En curso  ‚óã Pendiente                                     ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ     PROGRESO PLANES ACTIVOS        ‚îÇ ‚îÇ    PACIENTES CON ALERTA            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                    ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Mar√≠a G.  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 80%     ‚îÇ ‚îÇ  ‚ö†Ô∏è Pedro Soto                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Pedro S.  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë 60%     ‚îÇ ‚îÇ     No asiste hace 2 semanas       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Ana L.    ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 33%     ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Juan P.   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%    ‚îÇ ‚îÇ  ‚ö†Ô∏è Laura Mu√±oz                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Carlos D. ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 45%     ‚îÇ ‚îÇ     Plan pr√≥ximo a vencer (2 ses.) ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                    ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  [Ver todos planes ‚Üí]             ‚îÇ ‚îÇ  [Ver todos ‚Üí]                     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ     ADHERENCIA √öLTIMOS 3 MESES     ‚îÇ ‚îÇ     MIS ESTAD√çSTICAS               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                    ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  100%‚î§     ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ               ‚îÇ ‚îÇ  Promedio sesiones/paciente: 8.5   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      ‚îÇ    ‚ï±        ‚ï≤              ‚îÇ ‚îÇ  Tasa adherencia: 94.2%            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   90%‚î§   ‚ï±          ‚ï≤‚îÄ            ‚îÇ ‚îÇ  Planes completados (3m): 5        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      ‚îÇ  ‚ï±                         ‚îÇ ‚îÇ  Tasa √©xito planes: 85%            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   80%‚î§‚îÄ‚ï±                          ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ          ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ       Ene   Feb   Mar   Abr       ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.2 KPIs Profesionales

| KPI | Descripci√≥n | F√≥rmula |
|-----|-------------|---------|
| **Pacientes Activos** | Pacientes con plan activo o sesi√≥n reciente | COUNT(DISTINCT pacientes) con actividad en 30 d√≠as |
| **Sesiones Realizadas** | Sesiones completadas por el profesional | COUNT(sesiones) WHERE profesionalId = X |
| **Planes Activos** | Planes terap√©uticos en curso | COUNT(planes) WHERE estado = 'ACTIVO' |
| **Planes Completados** | Planes finalizados exitosamente | COUNT(planes) WHERE estado = 'COMPLETADO' |
| **Tasa de Adherencia** | Asistencia a citas del profesional | Realizadas / (Realizadas + No-show) √ó 100 |
| **Promedio Sesiones/Cliente** | Retenci√≥n del paciente | AVG(sesiones por paciente) |
| **Tasa √âxito Planes** | Planes completados vs totales | Completados / (Completados + Abandonados) √ó 100 |
| **Carga de Trabajo** | Utilizaci√≥n del tiempo | Horas agendadas / Horas disponibles √ó 100 |

---

## 3. Dashboard de Paciente (Fase 2)

### 3.1 Vista General

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           MI PORTAL - PACIENTE                                   ‚îÇ
‚îÇ                           Mar√≠a Gonz√°lez                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Mi Saldo        ‚îÇ ‚îÇ Pr√≥xima Sesi√≥n  ‚îÇ ‚îÇ Mi Plan         ‚îÇ ‚îÇ Sesiones        ‚îÇ‚îÇ
‚îÇ  ‚îÇ $0 (al d√≠a)     ‚îÇ ‚îÇ Ma√±ana 10:00    ‚îÇ ‚îÇ 80% completado  ‚îÇ ‚îÇ 8 de 10         ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚úì Sin deuda     ‚îÇ ‚îÇ Dr. Mu√±oz       ‚îÇ ‚îÇ 2 restantes     ‚îÇ ‚îÇ realizadas      ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                        MI EVOLUCI√ìN                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ  Dolor (EVA)                                                                 ‚îÇ‚îÇ
‚îÇ  ‚îÇ  10 ‚î§                                                                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ ‚óè                                                                      ‚îÇ‚îÇ
‚îÇ  ‚îÇ   7 ‚î§  ‚ï≤                                                                     ‚îÇ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ   ‚ï≤‚óè                                                                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ   5 ‚î§    ‚ï≤                                                                   ‚îÇ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ     ‚óè‚îÄ‚îÄ‚óè                                                               ‚îÇ‚îÇ
‚îÇ  ‚îÇ   3 ‚î§          ‚ï≤‚óè                                                            ‚îÇ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ                                                                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ   0 ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ                                                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ     Sem1 Sem2 Sem3 Sem4 Sem5                                                 ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ       MIS PR√ìXIMAS SESIONES        ‚îÇ ‚îÇ       MIS PAGOS RECIENTES          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                    ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  üìÖ Mar 20 Feb 10:00 - Dr. Mu√±oz  ‚îÇ ‚îÇ  ‚úì $90.000 - 15 Feb - Transfer.   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  üìÖ Jue 22 Feb 10:00 - Dr. Mu√±oz  ‚îÇ ‚îÇ  ‚úì $30.000 - 10 Feb - D√©bito      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                    ‚îÇ ‚îÇ  ‚úì $60.000 - 01 Feb - Transfer.   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  [Ver calendario completo ‚Üí]      ‚îÇ ‚îÇ                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                                    ‚îÇ ‚îÇ  [Ver historial ‚Üí]                ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                        MIS BOLETAS                                           ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                                              ‚îÇ‚îÇ
‚îÇ  ‚îÇ  üìÑ B-12350 | 15 Feb 2024 | $30.000 | [Descargar PDF]                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ  üìÑ B-12340 | 10 Feb 2024 | $30.000 | [Descargar PDF]                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ  üìÑ B-12330 | 05 Feb 2024 | $30.000 | [Descargar PDF]                       ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                                              ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4. M√©tricas y Agregaciones

### 4.1 Queries de Agregaci√≥n

```typescript
// services/dashboard/aggregations.ts

export class DashboardAggregations {

  // KPIs Financieros
  async getFinancialKPIs(tenantId: string, dateRange: DateRange) {
    const [ventas, cobranzas, deuda, saldosAFavor] = await Promise.all([
      // Ventas totales
      this.prisma.sesion.aggregate({
        where: {
          tenantId,
          estadoAtencion: 'REALIZADA',
          fechaHora: { gte: dateRange.from, lte: dateRange.to }
        },
        _sum: { precioFinal: true }
      }),

      // Cobranzas
      this.prisma.pago.aggregate({
        where: {
          tenantId,
          estado: 'CONFIRMADO',
          fechaPago: { gte: dateRange.from, lte: dateRange.to }
        },
        _sum: { monto: true }
      }),

      // Deuda pendiente
      this.prisma.sesion.aggregate({
        where: {
          tenantId,
          estadoAtencion: 'REALIZADA',
          estadoPago: { in: ['NO_PAGADA', 'PAGO_PARCIAL'] }
        },
        _sum: { precioFinal: true, montoPagado: true }
      }),

      // Saldos a favor
      this.prisma.pago.aggregate({
        where: {
          tenantId,
          estado: 'CONFIRMADO',
          saldoDisponible: { gt: 0 }
        },
        _sum: { saldoDisponible: true }
      })
    ]);

    return {
      ventasTotales: ventas._sum.precioFinal || 0,
      cobranzas: cobranzas._sum.monto || 0,
      tasaCobranza: ventas._sum.precioFinal
        ? (cobranzas._sum.monto / ventas._sum.precioFinal) * 100
        : 0,
      deudaPendiente: (deuda._sum.precioFinal || 0) - (deuda._sum.montoPagado || 0),
      saldosAFavor: saldosAFavor._sum.saldoDisponible || 0
    };
  }

  // KPIs Operacionales
  async getOperationalKPIs(tenantId: string, dateRange: DateRange) {
    const [sesiones, pacientes, adherencia] = await Promise.all([
      // Sesiones por estado
      this.prisma.sesion.groupBy({
        by: ['estadoAtencion', 'estadoAgenda'],
        where: {
          tenantId,
          fechaHora: { gte: dateRange.from, lte: dateRange.to }
        },
        _count: true
      }),

      // Pacientes activos y nuevos
      this.prisma.$queryRaw`
        SELECT
          COUNT(DISTINCT p.id) as activos,
          COUNT(DISTINCT CASE
            WHEN p."createdAt" >= ${dateRange.from} THEN p.id
          END) as nuevos
        FROM pacientes p
        INNER JOIN sesiones s ON s."pacienteId" = p.id
        WHERE p."tenantId" = ${tenantId}
        AND s."fechaHora" BETWEEN ${dateRange.from} AND ${dateRange.to}
      `,

      // C√°lculo de adherencia
      this.calculateAdherence(tenantId, dateRange)
    ]);

    return {
      sesionesRealizadas: this.countByStatus(sesiones, 'estadoAtencion', 'REALIZADA'),
      sesionesAgendadas: this.countByStatus(sesiones, 'estadoAgenda', 'AGENDADA'),
      sesionesNoShow: this.countByStatus(sesiones, 'estadoAgenda', 'NO_SHOW'),
      pacientesActivos: pacientes[0].activos,
      pacientesNuevos: pacientes[0].nuevos,
      tasaAdherencia: adherencia.rate,
      tasaNoShow: adherencia.noShowRate
    };
  }

  // Serie temporal de ingresos
  async getRevenueTimeSeries(
    tenantId: string,
    dateRange: DateRange,
    groupBy: 'day' | 'week' | 'month' = 'month'
  ) {
    const dateFormat = {
      day: 'YYYY-MM-DD',
      week: 'YYYY-WW',
      month: 'YYYY-MM'
    }[groupBy];

    return this.prisma.$queryRaw`
      SELECT
        TO_CHAR(s."fechaHora", ${dateFormat}) as periodo,
        SUM(s."precioFinal") as ingresos,
        SUM(s."montoPagado") as cobrado,
        COUNT(*) as sesiones
      FROM sesiones s
      WHERE s."tenantId" = ${tenantId}
      AND s."estadoAtencion" = 'REALIZADA'
      AND s."fechaHora" BETWEEN ${dateRange.from} AND ${dateRange.to}
      GROUP BY TO_CHAR(s."fechaHora", ${dateFormat})
      ORDER BY periodo
    `;
  }

  // Top pacientes con deuda
  async getTopDebtors(tenantId: string, limit: number = 10) {
    return this.prisma.$queryRaw`
      SELECT
        p.id,
        p."firstName",
        p."lastName",
        p.rut,
        SUM(s."precioFinal" - s."montoPagado") as deuda
      FROM pacientes p
      INNER JOIN sesiones s ON s."pacienteId" = p.id
      WHERE p."tenantId" = ${tenantId}
      AND s."estadoAtencion" = 'REALIZADA'
      AND s."estadoPago" IN ('NO_PAGADA', 'PAGO_PARCIAL')
      GROUP BY p.id
      HAVING SUM(s."precioFinal" - s."montoPagado") > 0
      ORDER BY deuda DESC
      LIMIT ${limit}
    `;
  }

  // Alertas del sistema
  async getAlerts(tenantId: string): Promise<Alert[]> {
    const alerts: Alert[] = [];

    // Pacientes con deuda alta
    const highDebtPatients = await this.prisma.paciente.count({
      where: {
        tenantId,
        saldoPendiente: { gte: 100000 }
      }
    });
    if (highDebtPatients > 0) {
      alerts.push({
        type: 'DEUDA_ALTA',
        severity: 'WARNING',
        message: `${highDebtPatients} pacientes con deuda > $100.000`
      });
    }

    // Sesiones sin boleta (m√°s de 5 d√≠as)
    const fiveDaysAgo = subDays(new Date(), 5);
    const sessionsWithoutBoleta = await this.prisma.sesion.count({
      where: {
        tenantId,
        estadoAtencion: 'REALIZADA',
        estadoBoleta: 'NO_EMITIDA',
        fechaHora: { lt: fiveDaysAgo }
      }
    });
    if (sessionsWithoutBoleta > 0) {
      alerts.push({
        type: 'SESIONES_SIN_BOLETA',
        severity: 'ERROR',
        message: `${sessionsWithoutBoleta} sesiones realizadas hace +5 d√≠as sin boleta`
      });
    }

    // Planes pr√≥ximos a vencer
    const planesProximosVencer = await this.prisma.planTerapeutico.count({
      where: {
        tenantId,
        estado: 'ACTIVO',
        fechaFinEstimada: {
          gte: new Date(),
          lte: addDays(new Date(), 7)
        }
      }
    });
    if (planesProximosVencer > 0) {
      alerts.push({
        type: 'PLANES_POR_VENCER',
        severity: 'INFO',
        message: `${planesProximosVencer} planes vencen en los pr√≥ximos 7 d√≠as`
      });
    }

    return alerts;
  }
}
```

### 4.2 Cach√© de M√©tricas

```typescript
// services/dashboard/cache.ts

export class DashboardCache {
  private redis: Redis;
  private readonly TTL = {
    realtime: 60,      // 1 minuto
    hourly: 3600,      // 1 hora
    daily: 86400       // 24 horas
  };

  // M√©tricas que se actualizan frecuentemente
  async getRealtimeMetrics(tenantId: string) {
    const cacheKey = `dashboard:${tenantId}:realtime`;

    let metrics = await this.redis.get(cacheKey);
    if (metrics) return JSON.parse(metrics);

    metrics = await this.aggregations.getFinancialKPIs(tenantId, todayRange());
    await this.redis.setex(cacheKey, this.TTL.realtime, JSON.stringify(metrics));

    return metrics;
  }

  // M√©tricas pre-calculadas (worker job)
  async preCalculateMetrics(tenantId: string) {
    // Este job corre cada hora
    const [financial, operational, timeSeries] = await Promise.all([
      this.aggregations.getFinancialKPIs(tenantId, currentMonthRange()),
      this.aggregations.getOperationalKPIs(tenantId, currentMonthRange()),
      this.aggregations.getRevenueTimeSeries(tenantId, last6MonthsRange(), 'month')
    ]);

    await this.redis.setex(
      `dashboard:${tenantId}:monthly`,
      this.TTL.hourly,
      JSON.stringify({ financial, operational, timeSeries })
    );
  }
}
```

---

## 5. Reportes

### 5.1 Tipos de Reportes

| Reporte | Descripci√≥n | Formato | Frecuencia |
|---------|-------------|---------|------------|
| **Resumen Financiero Mensual** | Ingresos, cobranzas, deuda por per√≠odo | PDF/Excel | Mensual |
| **Estado de Cuenta Paciente** | Sesiones, pagos, saldo de un paciente | PDF | On-demand |
| **Listado de Deudores** | Pacientes con saldo pendiente | Excel | Semanal |
| **Productividad Profesional** | Sesiones, adherencia por profesional | PDF/Excel | Mensual |
| **Evoluci√≥n de Planes** | Progreso de planes terap√©uticos | PDF | On-demand |
| **Conciliaci√≥n** | Discrepancias sesi√≥n/pago/boleta | Excel | Semanal |

### 5.2 Generaci√≥n de Reportes

```typescript
// services/reports/generator.ts

export class ReportGenerator {

  async generateFinancialReport(
    tenantId: string,
    dateRange: DateRange,
    format: 'pdf' | 'excel'
  ): Promise<Buffer> {
    // 1. Obtener datos
    const data = await this.getFinancialReportData(tenantId, dateRange);

    // 2. Generar documento
    if (format === 'pdf') {
      return this.generatePDF('financial-report', data);
    } else {
      return this.generateExcel('financial-report', data);
    }
  }

  private async getFinancialReportData(tenantId: string, dateRange: DateRange) {
    return {
      periodo: dateRange,
      resumen: await this.aggregations.getFinancialKPIs(tenantId, dateRange),
      ingresosPorDia: await this.aggregations.getRevenueTimeSeries(tenantId, dateRange, 'day'),
      distribucionPago: await this.aggregations.getPaymentMethodDistribution(tenantId, dateRange),
      topDeudores: await this.aggregations.getTopDebtors(tenantId, 20),
      sesionesDetalle: await this.getSesionesDetalle(tenantId, dateRange)
    };
  }
}
```
